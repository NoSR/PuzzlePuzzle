# MCP23017 GPIOB ν•€ ν™•μ¥ μ™„λ£

## π“‹ **ν™•μ¥λ ν•€ κµ¬μ„±**

### π”§ **MCP23017 #1 (I2C μ£Όμ†: 0x20) ν•€ ν• λ‹Ή**

#### **GPIOA (μ¶λ ¥μ©)**
- **λΉ„νΈ 0~3**: μ‚¬μ© μ•ν•¨ (μμ•½)
- **λΉ„νΈ 4~7**: λ¬Έμ  μ μ‹ LED (4κ°)

#### **GPIOB (μ…λ ¥μ©) - μƒλ΅ μ¶”κ°€**
- **λΉ„νΈ 0**: HEAD_LIMIT_SWITCH (Head λ¨ν„° λ¦¬λ―ΈνΈ μ¤μ„μΉ)
- **λΉ„νΈ 1**: BODY_LIMIT_SWITCH (Body λ¨ν„° λ¦¬λ―ΈνΈ μ¤μ„μΉ)
- **λΉ„νΈ 2~6**: DIGITAL_INPUT_0~4 (μ¶”κ°€ λ””μ§€ν„Έ μ…λ ¥ 5κ°)
- **λΉ„νΈ 7**: μ‚¬μ© μ•ν•¨ (μμ•½)

### π― **MCP23017 #2 (I2C μ£Όμ†: 0x21) ν•€ ν• λ‹Ή**

#### **GPIOA (μ¶λ ¥μ©)**
- **λΉ„νΈ 0~5**: μ μ LED (6κ°)
- **λΉ„νΈ 6~7**: μ‚¬μ© μ•ν•¨ (μμ•½)

## π”§ **μ£Όμ” λ³€κ²½ μ‚¬ν•­**

### 1. **λ¦¬λ―ΈνΈ μ¤μ„μΉ μ΄λ™**
```cpp
// κΈ°μ΅΄: Arduino λ””μ§€ν„Έ ν•€ μ‚¬μ©
#define HEAD_LIMIT_PIN 12    // μ κ±°λ¨
#define BODY_LIMIT_PIN 13    // μ κ±°λ¨

// μƒλ΅μ΄: MCP23017 #1 GPIOB μ‚¬μ©
#define HEAD_LIMIT_BIT 0     // MCP23017 #1 GPIOB 0λ² λΉ„νΈ
#define BODY_LIMIT_BIT 1     // MCP23017 #1 GPIOB 1λ² λΉ„νΈ
```

### 2. **μ¶”κ°€ λ””μ§€ν„Έ μ…λ ¥ ν•€**
```cpp
// μƒλ΅ μ¶”κ°€λ λ””μ§€ν„Έ μ…λ ¥
#define DIGITAL_INPUT_COUNT 5
#define DIGITAL_INPUT_START_BIT 2  // GPIOB 2λ² λΉ„νΈλ¶€ν„° μ‹μ‘
#define DIGITAL_INPUT_MASK 0x7C    // λΉ„νΈ 2,3,4,5,6 = 01111100

// μ‚¬μ© κ°€λ¥ν• λ””μ§€ν„Έ μ…λ ¥
// DIGITAL_INPUT_0: GPIOB λΉ„νΈ 2
// DIGITAL_INPUT_1: GPIOB λΉ„νΈ 3
// DIGITAL_INPUT_2: GPIOB λΉ„νΈ 4
// DIGITAL_INPUT_3: GPIOB λΉ„νΈ 5
// DIGITAL_INPUT_4: GPIOB λΉ„νΈ 6
```

### 3. **μƒλ΅μ΄ μƒνƒ κ΄€λ¦¬ κµ¬μ΅°μ²΄**
```cpp
struct DigitalInputState {
  uint8_t currentState;     // ν„μ¬ μ…λ ¥ μƒνƒ (λΉ„νΈ ν”λκ·Έ)
  uint8_t previousState;    // μ΄μ „ μ…λ ¥ μƒνƒ (λΉ„νΈ ν”λκ·Έ)
  unsigned long lastReadTime;  // λ§μ§€λ§‰ μ½κΈ° μ‹κ°„
  unsigned long debounceTime[DIGITAL_INPUT_COUNT];  // κ° μ…λ ¥μ λ””λ°”μ΄μ¤ μ‹κ°„
};
```

## π”§ **μƒλ΅μ΄ ν•¨μλ“¤**

### 1. **MCP23017 μ…λ ¥ μ½κΈ°**
```cpp
uint8_t readMCP23017Input(uint8_t addr, uint8_t reg);
```

### 2. **λ””μ§€ν„Έ μ…λ ¥ λ¨λ‹ν„°λ§**
```cpp
void monitorDigitalInputs();  // 10msλ§λ‹¤ μ…λ ¥ μƒνƒ μ—…λ°μ΄νΈ (λ””λ°”μ΄μ‹± ν¬ν•¨)
```

### 3. **λ¦¬λ―ΈνΈ μ¤μ„μΉ μ½κΈ°**
```cpp
bool readHeadLimitSwitch();   // Head λ¨ν„° λ¦¬λ―ΈνΈ μ¤μ„μΉ μƒνƒ
bool readBodyLimitSwitch();   // Body λ¨ν„° λ¦¬λ―ΈνΈ μ¤μ„μΉ μƒνƒ
```

### 4. **λ””μ§€ν„Έ μ…λ ¥ μ½κΈ°**
```cpp
bool readDigitalInput(uint8_t inputNumber);  // κ°λ³„ λ””μ§€ν„Έ μ…λ ¥ μ½κΈ° (0~4)
uint8_t readAllDigitalInputs();              // λ¨λ“  λ””μ§€ν„Έ μ…λ ¥μ„ ν•λ²μ— μ½κΈ°
```

### 5. **ν…μ¤νΈ ν•¨μ**
```cpp
void testDigitalInputs();  // λ””μ§€ν„Έ μ…λ ¥ μ‹¤μ‹κ°„ ν…μ¤νΈ
```

## π”§ **MCP23017 μ΄κΈ°ν™” λ³€κ²½**

### **GPIOB μ…λ ¥ μ„¤μ •**
```cpp
// GPIOB: μ…λ ¥ (λ¦¬λ―ΈνΈ μ¤μ„μΉ + λ””μ§€ν„Έ μ…λ ¥μ©)
Wire.beginTransmission(MCP23017_1_ADDR);
Wire.write(MCP_IODIRB);
Wire.write(0xFF);  // λ¨λ“  λΉ„νΈ μ…λ ¥
Wire.endTransmission();

// GPIOB ν’€μ—… ν™μ„±ν™”
Wire.beginTransmission(MCP23017_1_ADDR);
Wire.write(0x0D);  // GPPUB λ μ§€μ¤ν„°
Wire.write(0xFF);  // λ¨λ“  λΉ„νΈ ν’€μ—… ν™μ„±ν™”
Wire.endTransmission();
```

## π― **κΈ°λ¥ νΉμ§•**

### β… **λ””λ°”μ΄μ‹± μ²λ¦¬**
- λ¨λ“  μ…λ ¥μ— 50ms λ””λ°”μ΄μ‹± μ μ©
- λ…Έμ΄μ¦ λ° μ±„ν„°λ§ λ°©μ§€

### β… **ν’€μ—… μ €ν•­ ν™μ„±ν™”**
- MCP23017 λ‚΄μ¥ ν’€μ—… μ €ν•­ μ‚¬μ©
- μ™Έλ¶€ ν’€μ—… μ €ν•­ λ¶ν•„μ”

### β… **μ‹¤μ‹κ°„ λ¨λ‹ν„°λ§**
- 10ms μ£ΌκΈ°λ΅ μ…λ ¥ μƒνƒ μ—…λ°μ΄νΈ
- loop() ν•¨μμ—μ„ μλ™ νΈμ¶

### β… **λΉ„νΈ ν”λκ·Έ μµμ ν™”**
- λ©”λ¨λ¦¬ ν¨μ¨μ μΈ μƒνƒ κ΄€λ¦¬
- λΉ λ¥Έ λΉ„νΈ μ—°μ‚° ν™μ©

## π” **μ‚¬μ© λ°©λ²•**

### 1. **λ¦¬λ―ΈνΈ μ¤μ„μΉ μ½κΈ°**
```cpp
if (readHeadLimitSwitch()) {
  // Head λ¨ν„° λ¦¬λ―ΈνΈ μ¤μ„μΉκ°€ λλ¦Ό
}

if (readBodyLimitSwitch()) {
  // Body λ¨ν„° λ¦¬λ―ΈνΈ μ¤μ„μΉκ°€ λλ¦Ό
}
```

### 2. **κ°λ³„ λ””μ§€ν„Έ μ…λ ¥ μ½κΈ°**
```cpp
for (int i = 0; i < DIGITAL_INPUT_COUNT; i++) {
  if (readDigitalInput(i)) {
    Serial.print("λ””μ§€ν„Έ μ…λ ¥ ");
    Serial.print(i);
    Serial.println(" ν™μ„±ν™”");
  }
}
```

### 3. **λ¨λ“  λ””μ§€ν„Έ μ…λ ¥ ν•λ²μ— μ½κΈ°**
```cpp
uint8_t inputs = readAllDigitalInputs();
// inputsμ κ° λΉ„νΈκ°€ ν•΄λ‹Ή μ…λ ¥ μƒνƒλ¥Ό λ‚νƒ€λƒ„
// λΉ„νΈ 0 = DIGITAL_INPUT_0
// λΉ„νΈ 1 = DIGITAL_INPUT_1
// ...
// λΉ„νΈ 4 = DIGITAL_INPUT_4
```

## π” **ν…μ¤νΈ λ…λ Ήμ–΄**

### **μ‹λ¦¬μ–Ό λ¨λ‹ν„° λ…λ Ήμ–΄**
```
status       // μ‹μ¤ν… μƒνƒ (λ””μ§€ν„Έ μ…λ ¥ ν¬ν•¨)
input_test   // λ””μ§€ν„Έ μ…λ ¥ μ‹¤μ‹κ°„ ν…μ¤νΈ
motor_test   // λ¨ν„° ν…μ¤νΈ
led_test     // LED ν…μ¤νΈ
stop         // λ¨λ“  μ¶λ ¥ μ •μ§€
```

### **input_test μ¶λ ¥ μμ‹**
```
=== λ””μ§€ν„Έ μ…λ ¥ ν…μ¤νΈ ===
Head Limit: OFF | Body Limit: OFF | Digital Inputs: D0:0 D1:1 D2:0 D3:1 D4:0 | Raw: 0x0A
```

## β… **μ»΄νμΌ κ²°κ³Ό**
- **μƒνƒ**: μ„±κ³µ β…
- **RAM μ‚¬μ©λ‰**: 68.3% (1,398 / 2,048 bytes)
- **Flash μ‚¬μ©λ‰**: 42.6% (13,078 / 30,720 bytes)

## π― **ν™•μ¥λ κΈ°λ¥ μ”μ•½**

### β… **κΈ°μ΅΄ κΈ°λ¥ μ μ§€**
- β… λ¬Έμ  LED 4κ° (MCP23017 #1 GPIOA 4~7)
- β… μ μ LED 6κ° (MCP23017 #2 GPIOA 0~5)
- β… 7μ  ν΄λ¦¬μ–΄ λ„λ―Έλ…Έ ν¨κ³Ό
- β… μ§„λ™ μ„Όμ„ 4κ° (Arduino μ•„λ‚ λ΅κ·Έ ν•€)
- β… λ¨ν„° μ μ–΄ (Arduino λ””μ§€ν„Έ ν•€)

### β… **μƒλ΅ μ¶”κ°€λ κΈ°λ¥**
- β… Head λ¦¬λ―ΈνΈ μ¤μ„μΉ (MCP23017 #1 GPIOB 0)
- β… Body λ¦¬λ―ΈνΈ μ¤μ„μΉ (MCP23017 #1 GPIOB 1)
- β… λ””μ§€ν„Έ μ…λ ¥ 5κ° (MCP23017 #1 GPIOB 2~6)
- β… μ‹¤μ‹κ°„ μ…λ ¥ λ¨λ‹ν„°λ§ λ° λ””λ°”μ΄μ‹±
- β… λ””μ§€ν„Έ μ…λ ¥ ν…μ¤νΈ κΈ°λ¥

## π **ν™•μ¥ μ™„λ£!**

μ΄μ  MCP23017 #1μ GPIOB ν•€λ“¤μ„ ν™μ©ν•μ—¬:
1. **λ¦¬λ―ΈνΈ μ¤μ„μΉ 2κ°** (Arduino ν•€ μ μ•½)
2. **μ¶”κ°€ λ””μ§€ν„Έ μ…λ ¥ 5κ°** (μƒλ΅μ΄ μ„Όμ„ μ—°κ²° κ°€λ¥)

μ΄ **7κ°μ μ¶”κ°€ μ…λ ¥ ν•€**μ„ ν™•λ³΄ν–μµλ‹λ‹¤! π‰

μƒλ΅μ΄ μ„Όμ„λ‚ μ¤μ„μΉλ¥Ό μ—°κ²°ν•  μ¤€λΉ„κ°€ μ™„λ£λμ—μµλ‹λ‹¤!