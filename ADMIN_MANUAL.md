# 무궁화 게임 시스템 관리자 매뉴얼

## 📋 시스템 개요

### 하드웨어 구성
- **Master Board**: Arduino Mega 2560
- **Slave Board**: Arduino Nano  
- **통신**: UART Serial (9600 baud)
- **전원**: 12V DC 어댑터
- **센서**: PIR 센서 4개, 진동 센서 4개, 리미트 스위치 2개
- **액추에이터**: DC 모터 2개, LED 다수, 릴레이 8개
- **오디오**: DFPlayer Mini 2개

### 소프트웨어 구성
- **개발 환경**: PlatformIO
- **프로그래밍 언어**: C++
- **통신 프로토콜**: 커스텀 시리얼 프로토콜
- **안전장치**: 다중 안전 시스템 내장

## 🚀 시스템 시작 및 종료

### 시작 절차
1. **전원 연결 확인**
   ```
   12V DC 어댑터 → 전원 분배 보드 → 각 모듈
   ```

2. **보드 부팅 순서**
   ```
   1) Master Board 전원 ON
   2) 3초 대기
   3) Slave Board 전원 ON
   4) 초기화 완료 대기 (약 10초)
   ```

3. **초기화 상태 확인**
   - Master Board 시리얼 모니터 연결 (9600 baud)
   - "Master Board 초기화 완료" 메시지 확인
   - Slave Board 시리얼 모니터 연결 (9600 baud)  
   - "Slave Board 초기화 완료" 메시지 확인

4. **시스템 상태 점검**
   ```
   Master 시리얼 명령어: status
   Slave 시리얼 명령어: status
   ```

### 종료 절차
1. **게임 중단 확인**
   - 현재 진행 중인 게임이 없는지 확인
   - 필요시 `stop` 명령으로 강제 중단

2. **안전 종료**
   ```
   1) 모든 모터 정지 확인
   2) 모든 LED 소등 확인
   3) 오디오 재생 중단 확인
   4) Slave Board 전원 OFF
   5) Master Board 전원 OFF
   ```

## 🔧 일상 점검 및 유지보수

### 매일 점검 항목

#### 하드웨어 점검
- [ ] **전원 상태**
  - 12V 전원 어댑터 정상 동작
  - 전압 측정: 11.5V ~ 12.5V 범위 확인
  
- [ ] **LED 시스템**
  ```
  Master 명령어: led_test
  Slave 명령어: led_test
  ```
  - 천정 조명 4개 정상 점등/소등
  - 경광등 2개 정상 동작
  - 이펙트 LED 6개 정상 동작
  - 점수 LED 6개 정상 동작
  - 문제 제시 LED 4개 정상 동작

- [ ] **모터 시스템**
  ```
  Slave 명령어: motor_test
  ```
  - Head 모터 정방향/역방향 회전
  - Body 모터 정방향/역방향 회전
  - 리미트 스위치 정상 동작
  - 브레이크 시스템 정상 동작 (5초간 HIGH)

- [ ] **센서 시스템**
  ```
  Master 명령어: pir_test
  Slave 명령어: vibration
  ```
  - PIR 센서 4개 동작 감지
  - 진동 센서 4개 발판 감지
  - 센서 민감도 적절성 확인

- [ ] **오디오 시스템**
  ```
  Master 명령어: audio_test
  Slave 명령어: audio_test
  ```
  - Master DFPlayer 내레이션/BGM 재생
  - Slave DFPlayer 효과음 재생
  - 볼륨 레벨 적절성 (권장: 20/30)

#### 소프트웨어 점검
- [ ] **통신 상태**
  ```
  Master 명령어: comm_status
  Slave 명령어: comm_status
  ```
  - Master-Slave 통신 정상
  - 통신 오류율 < 1%
  - 응답 시간 < 50ms

- [ ] **메모리 사용량**
  ```
  Master 명령어: memory
  Slave 명령어: memory
  ```
  - Master SRAM 사용률 < 80%
  - Slave SRAM 사용률 < 85%

- [ ] **안전장치 상태**
  ```
  Master 명령어: safety_status
  Slave 명령어: safety_status
  ```
  - 모든 안전장치 정상 동작
  - 비상 정지 기능 정상
  - 과부하 보호 기능 정상

### 주간 점검 항목

#### 심화 점검
- [ ] **센서 캘리브레이션**
  ```
  Master 명령어: pir_calibrate
  Slave 명령어: calibrate
  ```

- [ ] **게임 플로우 테스트**
  - 전체 게임 1회 완주 테스트
  - 모든 레벨 정상 진행 확인
  - 클리어 시나리오 정상 동작 확인

- [ ] **로그 분석**
  ```
  Master 명령어: log_dump
  Slave 명령어: log_dump
  ```
  - 오류 로그 분석
  - 성능 지표 확인
  - 사용자 행동 패턴 분석

#### 청소 및 정비
- [ ] **센서 청소**
  - PIR 센서 렌즈 청소 (알코올 솜 사용)
  - 진동 센서 접촉부 청소
  - 리미트 스위치 접점 청소

- [ ] **기계 부품 점검**
  - 모터 축 윤활 상태 확인
  - 기어박스 이상음 확인
  - 케이블 연결 상태 점검

### 월간 점검 항목

#### 전체 시스템 점검
- [ ] **성능 벤치마크**
  - 응답 시간 측정 및 기록
  - 메모리 사용량 추이 분석
  - 통신 품질 지표 분석

- [ ] **부품 교체 검토**
  - 소모품 교체 주기 확인
  - 예비 부품 재고 확인
  - 업그레이드 필요성 검토

- [ ] **소프트웨어 업데이트**
  - 펌웨어 업데이트 확인
  - 보안 패치 적용
  - 기능 개선 사항 적용

## 🚨 문제 해결 가이드

### 일반적인 문제 및 해결책

#### 통신 오류
**증상**: Master-Slave 간 통신 실패
```
오류 메시지: "통신 타임아웃", "체크섬 오류"
```

**해결 방법**:
1. 시리얼 케이블 연결 확인
2. 보드 리셋 (Master → Slave 순서)
3. 통신 복구 명령 실행
   ```
   Master: comm_recovery
   Slave: comm_recovery
   ```
4. 전원 재시작 (최후 수단)

#### 센서 오작동
**증상**: PIR 센서 또는 진동 센서 비정상 동작
```
오류 메시지: "센서 오작동 감지", "임계값 초과"
```

**해결 방법**:
1. 센서 청소 및 점검
2. 캘리브레이션 재실행
   ```
   Master: pir_calibrate
   Slave: calibrate
   ```
3. 임계값 재조정
   ```
   Slave: threshold <새로운 값>
   ```
4. 센서 교체 (불량 시)

#### 모터 문제
**증상**: 로봇 Head/Body 모터 동작 불량
```
오류 메시지: "모터 타임아웃", "리미트 스위치 오류"
```

**해결 방법**:
1. 모터 연결 상태 확인
2. 리미트 스위치 동작 확인
3. 모터 드라이버 점검
4. 비상 정지 후 수동 리셋
   ```
   Slave: stop
   Slave: motor_test
   ```

#### 오디오 문제
**증상**: DFPlayer 재생 불량
```
오류 메시지: "DFPlayer 응답 없음", "트랙 재생 실패"
```

**해결 방법**:
1. SD 카드 연결 확인
2. 오디오 파일 무결성 확인
3. DFPlayer 리셋
   ```
   Master/Slave: audio_reset
   ```
4. 볼륨 레벨 조정
   ```
   Master/Slave: volume <0-30>
   ```

### 비상 상황 대응

#### 시스템 전체 정지
**상황**: 시스템이 응답하지 않음

**대응 절차**:
1. **즉시 전원 차단**
2. **안전 확인** (사용자 대피)
3. **하드웨어 점검**
4. **로그 분석**
5. **단계별 재시작**

#### 안전장치 작동
**상황**: 과부하, 과열 등 안전장치 작동

**대응 절차**:
1. **원인 파악**
   ```
   Master: safety_status
   Slave: safety_status
   ```
2. **문제 해결**
3. **안전장치 리셋**
   ```
   Master: safety_reset
   Slave: safety_reset
   ```
4. **정상 동작 확인**

## 📊 모니터링 및 로그 관리

### 실시간 모니터링

#### 시스템 상태 대시보드
```
Master 명령어: dashboard
```
- 게임 상태, 점수, 레벨
- 하드웨어 상태 (LED, 모터, 센서)
- 통신 상태 및 품질
- 메모리 사용량
- 안전장치 상태

#### 성능 지표 모니터링
```
Master 명령어: performance
Slave 명령어: performance
```
- CPU 사용률
- 메모리 사용률  
- 통신 지연 시간
- 오류 발생 빈도

### 로그 관리

#### 로그 수집
```
Master 명령어: log_export
Slave 명령어: log_export
```

#### 로그 분석 항목
- **오류 로그**: 시스템 오류 및 예외 상황
- **성능 로그**: 응답 시간, 처리량 등
- **사용자 로그**: 게임 플레이 패턴, 성공률 등
- **하드웨어 로그**: 센서 데이터, 모터 동작 등

#### 로그 보관 정책
- **일간 로그**: 30일 보관
- **주간 요약**: 1년 보관
- **월간 요약**: 영구 보관
- **오류 로그**: 영구 보관

## 🔐 보안 및 백업

### 시스템 보안

#### 접근 제어
- 물리적 접근 제한 (잠금 장치)
- 시리얼 포트 보안 (필요시 암호화)
- 펌웨어 무결성 검증

#### 보안 점검
- [ ] 하드웨어 변조 흔적 확인
- [ ] 소프트웨어 무결성 검증
- [ ] 접근 로그 분석

### 백업 및 복구

#### 정기 백업
```bash
# 펌웨어 백업
platformio run --target backup

# 설정 파일 백업
cp config/*.h backup/config/

# 로그 파일 백업
cp logs/*.log backup/logs/
```

#### 복구 절차
1. **펌웨어 복구**
   ```bash
   platformio run --target restore
   ```

2. **설정 복구**
   ```bash
   cp backup/config/*.h config/
   ```

3. **시스템 재시작**
4. **동작 확인**

## 📞 지원 및 연락처

### 기술 지원 단계

#### 1단계: 자체 해결
- 본 매뉴얼 참조
- 시스템 진단 도구 활용
- 기본 문제 해결 시도

#### 2단계: 원격 지원
- **기술 지원팀**: [연락처]
- **지원 시간**: 평일 09:00-18:00
- **원격 접속**: TeamViewer 등

#### 3단계: 현장 지원
- **긴급 상황**: 24시간 대응
- **정기 점검**: 사전 예약
- **부품 교체**: 당일 방문

### 비상 연락처
- **현장 관리자**: [연락처]
- **기술 지원팀**: [연락처]
- **개발팀**: [연락처]
- **응급 상황**: 119

### 부품 주문 및 교체

#### 주요 소모품
| 부품명 | 교체 주기 | 재고 수량 | 공급업체 |
|--------|-----------|-----------|----------|
| PIR 센서 | 1년 | 2개 | [업체명] |
| 진동 센서 | 6개월 | 4개 | [업체명] |
| DC 모터 | 2년 | 1개 | [업체명] |
| DFPlayer Mini | 1년 | 2개 | [업체명] |
| SD 카드 | 6개월 | 2개 | [업체명] |

#### 주문 절차
1. 재고 확인
2. 주문서 작성
3. 승인 요청
4. 발주 및 납품
5. 입고 검수

---

## 📝 체크리스트

### 일일 점검 체크리스트
```
□ 전원 상태 확인
□ LED 시스템 테스트
□ 모터 시스템 테스트  
□ 센서 시스템 테스트
□ 오디오 시스템 테스트
□ 통신 상태 확인
□ 메모리 사용량 확인
□ 안전장치 상태 확인
□ 게임 플로우 테스트
□ 로그 확인 및 기록
```

### 주간 점검 체크리스트
```
□ 센서 캘리브레이션
□ 전체 게임 테스트
□ 로그 분석
□ 센서 청소
□ 기계 부품 점검
□ 성능 지표 기록
□ 예비 부품 재고 확인
```

### 월간 점검 체크리스트
```
□ 성능 벤치마크
□ 부품 교체 검토
□ 소프트웨어 업데이트
□ 보안 점검
□ 백업 실행
□ 문서 업데이트
□ 교육 및 훈련
```

---

**버전**: 1.0  
**최종 업데이트**: 2025년 8월 31일  
**작성자**: 무궁화 게임 시스템 개발팀